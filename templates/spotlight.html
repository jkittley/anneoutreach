{% extends "base.html" %}

{% block script %}
    <script>
    $(document).ready(function() {

        var elemId = "canvas";
        var table_width = {{ table_width }};
        var table_depth = {{ table_depth }};

        var $canvas=$("#"+elemId);
        var ctx= document.getElementById(elemId).getContext("2d");
        document.getElementById(elemId).width  = $canvas.width();
        document.getElementById(elemId).height = $canvas.height();
        var cw = $canvas.width();
        var ch = $canvas.height();
        var cx = 50;
        var cy = 50;
        var radius = 100;
        var PI2 = Math.PI*2;

        var img = new Image();
        img.src = "/static/img/spotlight.jpg";

        function draw(){
            ctx.clearRect(0,0,cw,ch);
            ctx.save();
            ctx.beginPath();
            ctx.arc(cx,cy,radius,0,PI2);
            ctx.closePath();
            ctx.stroke();
            ctx.clip();
{#            ctx.drawImage(img,0,0);#}
            ctx.drawImage(img, 0, 0, img.width, img.height, 0, 0, cw, ch);
            ctx.restore();
            //ctx.beginPath();
            //ctx.lineTo(cx, cy);
            //ctx.stroke();
            //ctx.closePath();
        }

        // Web socket setup
        sm = new SocketManager(function(newdata) {
            cx = parseInt((newdata.data.x / table_width) * cw);
            //cx = newdata.data.x;
            cy = parseInt((newdata.data.y / table_depth) * ch);
            //cy = newdata.data.y;
            console.log([cx,cy,table_width,table_width]);
            draw();
        });
        sm.connect();

    });
    </script>
{% endblock %}

{% block style %}
<style>
body{
    background-color: black;
    overflow: hidden;
}
#canvas{
    width: 100vw;
    height: 100vh;
}
</style>
{% endblock %}

{% block content %}
    <canvas id="canvas"></canvas>
{% endblock %}

